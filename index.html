<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeechMap.AI Explorer</title>
    <link href="https://unpkg.com/tabulator-tables@5.5.4/dist/css/tabulator_simple.min.css" rel="stylesheet">
    <link href="style.css?1" rel="stylesheet">
    <script defer src="https://unpkg.com/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
</head>
<body x-data="explorerData()" x-init="initialize()">

    <h1>SpeechMap.AI <span class="subtitle">The Free Speech Dashboard for AI.</span></h1>

    <nav class="view-selector">
        <button @click="navigate('about')" :class="{ 'active': currentView === 'about' }">About</button>
        <button @click="navigate('overview')" :class="{ 'active': currentView === 'overview' }">Model Overview</button>
        <button @click="navigate('question_themes')" :class="{ 'active': currentView === 'question_themes' }">Question Themes</button>
    </nav>
    <hr>

    <div x-show="isLoading" class="loading-indicator" x-text="loadingMessage"></div>
    <div x-show="errorMessage" class="error-message" x-text="errorMessage"></div>

    <!-- About View -->
    <div x-show="currentView === 'about'" class="about-content">

        <!-- New Hero Section -->
        <div class="about-hero">
            <div class="hero-text">
                <h2>We map the invisible<br>boundaries of AI speech</h2>
            </div>
            <div class="hero-image">
                <!-- Replaced placeholder div with img tag -->
                <img src="graphic.png" alt="Map showing AI model responses across regions" class="hero-graphic">
            </div>
        </div>

        <!-- New Grid Section -->
        <div class="about-grid">
            <div class="grid-item what-is">
                <!-- Updated Text -->
                <h3>What is SpeechMap.AI?</h3>
                <p>SpeechMap.AI is a research project that explores the limits of AI-generated speech.</p>
                <p>We test how language models respond to sensitive and controversial prompts across different providers, countries, and themes.</p>
                <p>Most organizations focus on what models are capable of.<br>We focus on what they avoid, refuse, or shut down.</p>
            </div>

            <div class="grid-item where-lines"> <!-- Renamed class -->
                 <!-- Updated Text -->
                <h3>Where are the lines drawn‚Äî</h3>
                <p>and how does that affect access to dissent, satire, or debate?</p>
                <p>Many prompts land in a gray area:</p>
                <ul>
                    <li>Political criticism</li>
                    <li>Satirical takes on leadership</li>
                    <li>Religious or moral arguments</li>
                    <li>Questions about rights or protest</li>
                </ul>
                <p>One model might answer. Another might refuse. A third might redirect the question. We test across phrasing, region, and topic to reveal how model behavior changes‚Äîand why that matters.</p>
            </div>

            <div class="grid-item why-matters">
                 <!-- Updated Text -->
                <h3>Why It Matters</h3>
                 <p>Language models are becoming part of how we write, search, learn, and communicate. As they become embedded in everyday tools, the limits on what they‚Äôll say begin to matter.</p>
                 <p>Some models block criticism of governments. Others avoid political speech or satire altogether. If these systems shape public discourse, then understanding their boundaries is a public interest issue.</p>
                 <p>SpeechMap.AI helps researchers, developers, and citizens see and compare those boundaries.</p>
            </div>

            <div class="grid-item stats-block">
                 <!-- Updated Structure and Text -->
                <h3>What‚Äôs Here Now</h3>
                <ul>
                    <li><strong class="stat-value" x-text="stats.models">0</strong> AI Models Compared</li>
                    <li><strong class="stat-value" x-text="stats.themes">0</strong> Question Themes</li>
                    <li><strong class="stat-value" x-text="formatJudgments(stats.judgments)">0</strong> Prompt-Level Judgments</li>
                    <li>Models tested on sensitive and political US prompts</li>
                    <li>Responses tagged as:
                        <ul class="compliance-key-list">
                            <li class="compliance-key-item">‚úÖ<span>Complete ‚Äì Direct response</span></li>
                            <li class="compliance-key-item">‚ö†Ô∏è<span>Evasive ‚Äì Redirected or partial</span></li>
                            <li class="compliance-key-item">‚ùå<span>Denied ‚Äì Policy-based refusal</span></li>
                            <li class="compliance-key-item">üõë<span>Error ‚Äì Possible moderation block</span></li>
                        </ul>
                    </li>
                    <li class="stats-cta">‚Üí Explore the <a href="#/overview" @click.prevent="navigate('overview')">Model Overview</a> or <a href="#/questions" @click.prevent="navigate('question_themes')">Browse Questions</a></li>
                </ul>
            </div>
        </div>

        <!-- Ko-fi Section -->
        <h3>‚òï Support us on Ko-fi</h3>
        <p>API fees can add up quickly: thorough AI evaluations are pricy to run. SpeechMap.ai runs on volunteer time and donations. If you would like to support our mission, please consider donating on <a href="https://ko-fi.com/xlr8harder" target="_blank" rel="noopener noreferrer">Ko-fi</a>!</p>
        <p><a href="https://ko-fi.com/xlr8harder" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/Support%20Us%20on%20Ko%20fi-F16061?style=flat-square&logo=ko-fi&logoColor=white" alt="Support Us on Ko-fi"></a></p>
        <!-- End Ko-fi Section -->

    </div>


    <!-- Overview View -->
    <div x-show="currentView === 'overview' && !isLoading && !errorMessage">
        <h2>Model Overview <span class="count-info" x-text="`(${modelSummary.length} Models)`"></span></h2>
        <p>Overall summary of model compliance. Click on a model name in the table below to see detailed results for that specific model.</p>
        <div id="overview-table" class="table-container"></div>
    </div>

    <!-- Model Detail View -->
    <template x-if="currentView === 'model_detail' && selectedModelData && !isLoading && !errorMessage">
        <div>
            <h2 x-text="`Model Details: ${selectedModelData.model}`"></h2>
            <button @click="navigate('overview')">‚Üê Back to Overview</button>
            <h3>Compliance by Question Theme</h3>
            <div id="model-detail-table" class="table-container"></div>
        </div>
    </template>

    <!-- Question Theme List View -->
    <div x-show="currentView === 'question_themes' && !isLoading && !errorMessage">
         <h2>Question Themes <span class="count-info" x-text="`(${questionThemeSummary.length} Themes)`"></span></h2>
         <p>Overall compliance for each question theme across all models.</p>
         <p>Click on a question theme to view prompts and model responses.</p>
         <div id="question-themes-table" class="table-container"></div>
    </div>

     <!-- Question Theme Detail View -->
     <template x-if="currentView === 'question_theme_detail' && selectedQuestionThemeData && !isLoading && !errorMessage">
         <div>
            <h2 x-text="`Question Theme: ${selectedQuestionThemeData.grouping_key}`"></h2>
            <button @click="navigate('question_themes')">‚Üê Back to Question Themes</button>
            <p><strong>Domain:</strong> <span x-text="selectedQuestionThemeData.domain"></span></p>
            <details class="toc-details" open>
                <summary>Model Compliance Summary & Links</summary>
                <ul class="toc-links model-toc vertical">
                    <template x-for="modelInfo in selectedQuestionThemeModelSummary" :key="modelInfo.model">
                        <li>
                            <a :href="'#' + modelInfo.anchor_id" class="toc-link-item" @click.prevent="smoothScroll('#' + modelInfo.anchor_id)">
                                <span class="toc-model-name" x-text="modelInfo.model"></span>
                                <span class="toc-right-group">
                                    <span class="toc-compliance-box" :style="getComplianceBoxStyle(modelInfo.pct_complete)" x-text="modelInfo.pct_complete.toFixed(1) + '%'"></span>
                                    <span class="toc-response-count">(<span x-text="modelInfo.count"></span> Resp.)</span>
                                </span>
                            </a>
                        </li>
                    </template>
                    <li x-show="selectedQuestionThemeModelSummary.length === 0" style="list-style:none; font-style:italic;">No responses found.</li>
                </ul>
            </details>
            <h3>Responses by Model</h3>
            <div class="response-list">
                 <template x-if="selectedQuestionThemeData.responses && selectedQuestionThemeData.responses.length > 0">
                     <template x-for="modelGroup in groupResponsesByModel(selectedQuestionThemeData.responses)" :key="modelGroup.model">
                         <section class="model-section" :id="modelGroup.responses[0].anchor_id">
                             <h4 class="model-section-header"><span x-text="modelGroup.model"></span></h4>
                             <template x-for="response in modelGroup.responses" :key="response.id">
                                 <div class="response-card-nested">
                                    <div class="response-header nested-header">
                                        <strong x-text="getVariationDescription(response.variation)"></strong>
                                    </div>
                                    <div class="error-box" x-show="response.error_message"> <strong class="error-message">Provider Error:</strong> <span x-text="response.error_message"></span> <span class="partial-warning" x-show="response.is_partial_response">(Response may be incomplete)</span> </div>
                                    <div class="response-content-area nested-content">
                                        <div class="detail-section question-section">
                                             <strong>Question:</strong>
                                             <span class="compliance-label" :class="'compliance-' + response.compliance" x-text="response.compliance"></span>
                                             <a class="openrouter-link"
                                                :href="generateOpenRouterLink(response.model, response.question_text)"
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                title="Try this prompt on OpenRouter">
                                                 Try this prompt on <img src="https://openrouter.ai/favicon.ico" alt="OpenRouter Logo"> OpenRouter
                                             </a>
                                             <pre class="text-display" x-text="response.question_text"></pre>
                                        </div>
                                         <div class="detail-section"> <strong>Model Response:</strong> <div class="text-display markdown-content" x-html="renderMarkdown(response.response_text || '(No Response Content)')"></div> </div>
                                         <div class="detail-section"> <strong>Judge Analysis (<span x-text="response.judge_model || 'N/A'"></span>):</strong> <div class="text-display markdown-content" x-html="renderMarkdown(response.judge_analysis || '(No Analysis Available)')"></div> </div>
                                    </div>
                                 </div>
                             </template>
                         </section>
                     </template>
                 </template>
                 <template x-if="!selectedQuestionThemeData.responses || selectedQuestionThemeData.responses.length === 0"> <p>No individual responses found.</p> </template>
            </div>
         </div>
     </template>

    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.4/dist/js/tabulator.min.js"></script>
    <script src="script.js?1"></script>
</body>
</html>
