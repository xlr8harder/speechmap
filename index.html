<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeechMap.AI Explorer</title>
    <link href="https://unpkg.com/tabulator-tables@5.5.4/dist/css/tabulator_simple.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <script defer src="https://unpkg.com/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
</head>
<body x-data="explorerData()" x-init="initialize()"> <!-- initialize starts loading -->

    <h1>SpeechMap.AI <span class="subtitle">The Free Speech Dashboard for AI.</span></h1>

    <nav class="view-selector">
        <button @click="navigate('about')" :class="{ 'active': currentView === 'about' }">About</button>
        <button @click="navigate('overview')" :class="{ 'active': currentView === 'overview' }">Model Overview</button>
        <button @click="navigate('question_themes')" :class="{ 'active': currentView === 'question_themes' }">Question Themes</button>
    </nav>
    <hr>

    <!-- Global Loading Indicator (Doesn't block About page) -->
    <div x-show="isLoading" class="loading-indicator" x-text="loadingMessage"></div>
    <div x-show="errorMessage" class="error-message" x-text="errorMessage"></div>

    <!-- About View -->
    <div x-show="currentView === 'about'" class="about-content">
        <h2>About SpeechMap.AI</h2>
        <p>AI language models are becoming one of the most powerful tools for generating, shaping, and amplifying speech. Like the printing press or the internet before them, they have the potential to expand public discourse—or restrict it.</p>
        <p><strong>SpeechMap.AI</strong> is an ongoing project that explores what today’s AI systems will and won’t say, especially in the realm of political, ethical, and ideological speech. We evaluate how different models respond to contentious or sensitive prompts across languages, countries, and topics. While many companies and researchers focus on model <em>capabilities</em>, we focus on model <em>boundaries</em>.</p>
        <p>We’re not here to argue that AI models should answer every question or generate any kind of content. Some requests are dangerous, harmful, or fall into ethical gray zones. But we believe it's important to understand where the lines are drawn—especially when those lines affect access to political expression, dissent, or minority viewpoints.</p>
        <p><strong>In short: we map the terrain.</strong><br>
        We identify what’s possible, what’s prohibited, and how those limits vary across providers and regions. Our goal is to provide a clear, evolving picture of how language models are shaping—and sometimes constraining—the space of human expression.</p>
        <h3>Why it matters</h3>
        <p>As AI becomes embedded in writing tools, chat interfaces, search engines, and creative platforms, the <em>invisible boundaries</em> of what these systems will say begin to matter more. If these models are part of the infrastructure of speech, then understanding their constraints is a matter of public interest.</p>
        <p>Different models behave differently. Some refuse to generate criticism of governments. Others avoid controversial topics altogether. Some will complete a prompt if it’s phrased one way, but not another. SpeechMap.AI helps surface these differences and provides tools to explore them.</p>
        <p>While we have a strong pro-free speech bias, we aim to be transparent, thoughtful, and open-ended. Our hope is that <strong>SpeechMap.AI</strong> helps researchers, journalists, developers, and citizens better understand how AI is shaping the landscape of expression—and what that means for the future.</p>
        <h3>What you’ll find here today</h3>
        <p>We are launching with an explorer for a dataset covering sensitive or contentious topics often related to US political discourse:</p>
        <ul>
            <li>Prompts are grouped into broad <strong>Domains</strong>.</li>
            <li>Each prompt "theme" (e.g., 'gov_democracy_critique_expert') has four <strong>Variations</strong>:
                <ul class="variation-list"> <template x-for="(desc, type) in variationMap" :key="type"> <li :title="'Type ' + type" ><strong x-text="'Type ' + type + ':'"></strong> <span x-text="desc.replace('Type ' + type + ': ', '')"></span></li> </template> </ul>
            </li>
             <li>Exploration views comparing model performance (<strong><a href="/#/overview">Model Overview</a></strong>) and question theme difficulty (<strong><a href="/#/questions">Question Themes</a></strong>).</li>
             <li>Detailed views showing individual model responses and judge analysis.</li>
        </ul>
         <p>Compliance is judged based on whether the model fulfilled the specific request (Complete), redirected or answered partially (Evasive), refused directly citing policy/harm (Denial), or encountered a technical error, typically indicative of moderation (Error).</p>
    </div>


    <!-- Overview View - ** x-show depends on isLoading now ** -->
    <div x-show="currentView === 'overview' && !isLoading && !errorMessage">
        <h2>Model Overview <span class="count-info" x-text="`(${modelSummary.length} Models)`"></span></h2>
        <!-- Explanatory text added -->
        <!-- TOC Removed -->
        <div class="filters"> <label>Sort Models By: <select x-model="overviewSortKey" @change="navigate('overview', true)"> <option value="model">Name (A-Z)</option> <option value="pct_complete_overall">Overall Compliance (Asc)</option> </select> </label> </div>
        <p>Click on a model name in the table below to see detailed results for that specific model.</p>
        <div id="overview-table" class="table-container"></div>
    </div>

    <!-- Model Detail View - ** x-show depends on isLoading ** -->
    <template x-if="currentView === 'model_detail' && selectedModelData && selectedModelDetailedStats && !isLoading && !errorMessage">
        <div>
            <h2 x-text="`Model Details: ${selectedModelData.model}`"></h2>
            <button @click="navigate('overview')">← Back to Overview</button>
            <!-- Interactive Model Stats Section -->
            <div class="model-stats-box">
                <h3>Performance Summary</h3>
                <div class="stats-grid">
                    <div><strong>Overall % Complete:</strong> <span class="stat-value" x-text="selectedModelDetailedStats.overall.pct_complete.toFixed(1) + '%'"></span> <span class="stat-count">(<span x-text="selectedModelDetailedStats.overall.complete_count"></span>/<span x-text="selectedModelDetailedStats.overall.count"></span> Total Responses)</span> </div>
                    <div class="filter-group"><strong>Compliance Breakdown (Filter Table Below):</strong>
                        <ul class="stats-list vertical"> <template x-for="level in complianceOrder" :key="level"> <li x-show="selectedModelDetailedStats.overall.counts[level] > 0"> <label class="checkbox-label" :title="level + ': ' + selectedModelDetailedStats.overall.counts[level] + ' (' + selectedModelDetailedStats.overall.percentages[level].toFixed(1) + '%)'"> <input type="checkbox" :value="level" x-model="activeModelComplianceFilters" @change="navigate('model_detail', true)"> <span class="compliance-label summary-label" :class="'compliance-' + level"> <span x-text="level"></span>: <span x-text="selectedModelDetailedStats.overall.percentages[level].toFixed(1) + '%'"></span> (<span x-text="selectedModelDetailedStats.overall.counts[level]"></span>) </span> </label> </li> </template> </ul>
                    </div>
                     <div class="filter-group"><strong>By Variation (% Complete - Filter Table Below):</strong>
                         <ul class="stats-list vertical"> <template x-for="vStat in selectedModelDetailedStats.by_variation" :key="vStat.variation"> <li x-show="vStat.count > 0"> <label class="checkbox-label" :title="'Filter by Type ' + vStat.variation"> <input type="checkbox" :value="vStat.variation" x-model="activeModelVariationFilters" @change="navigate('model_detail', true)"> <strong x-text="getVariationDescription(vStat.variation) + ':'"></strong> <span x-text="vStat.pct_complete.toFixed(1) + '%'"></span> (<span x-text="vStat.count"></span>) </label> </li> </template> </ul>
                    </div>
                     <div class="filter-group"><strong>By Domain (% Complete - Filter Table Below):</strong>
                         <ul class="stats-list vertical"> <template x-for="domainStat in selectedModelDetailedStats.by_domain_sorted" :key="domainStat.domain"> <li x-show="domainStat.count > 0"> <label class="checkbox-label" :title="'Filter by ' + domainStat.domain"> <input type="checkbox" :value="domainStat.domain" x-model="activeModelDomainFilters" @change="navigate('model_detail', true)"> <span x-text="domainStat.domain"></span>: <span x-text="domainStat.pct_complete.toFixed(1) + '%'"></span> (<span x-text="domainStat.count"></span>) </label> </li> </template> </ul>
                    </div>
                </div>
                 <button class="clear-all-filters-button" @click="clearModelDetailFilters()" x-show="activeModelComplianceFilters.length > 0 || activeModelDomainFilters.length > 0 || activeModelVariationFilters.length > 0">Clear All Table Filters</button>
            </div>
            <h3>Filtered Compliance by Question Theme</h3>
            <p class="filter-status"> Showing themes where model compliance matches filters: <strong x-show="activeModelDomainFilters.length > 0" x-text="`Domains: ${activeModelDomainFilters.join(', ')}; `"></strong> <span x-show="activeModelDomainFilters.length === 0">All Domains;</span> <strong x-show="activeModelVariationFilters.length > 0" x-text="`Variations: ${activeModelVariationFilters.map(v => 'Type ' + v).join(', ')}; `"></strong> <span x-show="activeModelVariationFilters.length === 0">All Variations;</span> <strong x-show="activeModelComplianceFilters.length > 0" x-text="`Compliance: ${activeModelComplianceFilters.join(', ')}; `"></strong> <span x-show="activeModelComplianceFilters.length === 0">All Compliance;</span> </p>
             <div class="filters"> <label>Sort Questions By: <select x-model="modelDetailSortKey" @change="navigate('model_detail', true)"> <option value="grouping_key">Name (A-Z)</option> <option value="pct_complete">Compliance (Asc)</option> </select> </label> </div>
            <div id="model-detail-table" class="table-container"></div>
        </div>
    </template>

    <!-- Question Theme List View - ** x-show depends on isLoading ** -->
    <div x-show="currentView === 'question_themes' && !isLoading && !errorMessage">
         <h2>Question Themes <span class="count-info" x-text="`(${questionThemeSummary.length} Themes)`"></span></h2>
         <!-- Question Theme Domain Filter/TOC -->
         <details class="toc-details">
            <summary>Filter by Domain</summary>
            <div class="toc-links"> <button class="toc-button" :class="{'active': !questionThemeDomainFilter}" @click="filterQuestionThemesByDomain('')">All Domains</button> <template x-for="domain in availableFilters.domains" :key="domain"><button :class="{'active': questionThemeDomainFilter === domain}" class="toc-button" @click="filterQuestionThemesByDomain(domain)" x-text="domain"></button></template> </div>
        </details>
         <div class="filters"> <label>Sort Themes By: <select x-model="questionThemeSortKey" @change="navigate('question_themes', true)"> <option value="grouping_key">Name (A-Z)</option> <option value="pct_complete_overall">Compliance (Asc)</option> <option value="num_responses"># Responses (Desc)</option> </select> </label> </div>
         <p>Click on a question theme to view prompts and model responses.</p>
         <div id="question-themes-table" class="table-container"></div>
    </div>

     <!-- Question Theme Detail View - ** x-show depends on isLoading ** -->
     <template x-if="currentView === 'question_theme_detail' && selectedQuestionThemeData && !isLoading && !errorMessage">
         <div>
            <h2 x-text="`Question Theme: ${selectedQuestionThemeData.grouping_key}`"></h2>
            <button @click="navigate('question_themes')">← Back to Question Themes</button>
            <p><strong>Domain:</strong> <span x-text="selectedQuestionThemeData.domain"></span></p>
            <details class="toc-details" open>
                <summary>Model Compliance Summary & Links</summary>
                <ul class="toc-links model-toc vertical"> <template x-for="modelInfo in selectedQuestionThemeModelSummary" :key="modelInfo.model"> <li> <a :href="'#' + modelInfo.anchor_id" class="toc-link-item" @click.prevent="smoothScroll('#' + modelInfo.anchor_id)"> <span class="toc-model-name" x-text="modelInfo.model"></span> <span class="toc-compliance-box" :style="getComplianceBoxStyle(modelInfo.pct_complete)" x-text="modelInfo.pct_complete.toFixed(1) + '%'"> </span> <span class="toc-response-count">(<span x-text="modelInfo.count"></span> Resp.)</span> </a> </li> </template> <li x-show="selectedQuestionThemeModelSummary.length === 0" style="list-style:none; font-style:italic;">No responses found.</li> </ul>
            </details>
            <h3>Responses by Model</h3>
            <div class="response-list">
                 <template x-if="selectedQuestionThemeData.responses && selectedQuestionThemeData.responses.length > 0">
                     <template x-for="modelGroup in groupResponsesByModel(selectedQuestionThemeData.responses)" :key="modelGroup.model">
                         <section class="model-section" :id="modelGroup.responses[0].anchor_id">
                             <h4 class="model-section-header"><span x-text="modelGroup.model"></span></h4>
                             <template x-for="response in modelGroup.responses" :key="response.id">
                                 <div class="response-card-nested">
                                    <div class="response-header nested-header"> <strong x-text="getVariationDescription(response.variation)"></strong> </div>
                                    <div class="error-box" x-show="response.error_message"> <strong class="error-message">Provider Error:</strong> <span x-text="response.error_message"></span> <span class="partial-warning" x-show="response.is_partial_response">(Response may be incomplete)</span> </div>
                                    <div class="response-content-area nested-content">
                                        <div class="detail-section question-section"> <strong>Question:</strong> <span class="compliance-label" :class="'compliance-' + response.compliance" x-text="response.compliance"></span> <pre class="text-display" x-text="response.question_text"></pre> </div>
                                         <div class="detail-section"> <strong>Model Response:</strong> <div class="text-display markdown-content" x-html="renderMarkdown(response.response_text || '(No Response Content)')"></div> </div>
                                         <div class="detail-section"> <strong>Judge Analysis (<span x-text="response.judge_model || 'N/A'"></span>):</strong> <div class="text-display markdown-content" x-html="renderMarkdown(response.judge_analysis || '(No Analysis Available)')"></div> </div>
                                    </div>
                                 </div>
                             </template>
                         </section>
                     </template>
                 </template>
                 <template x-if="!selectedQuestionThemeData.responses || selectedQuestionThemeData.responses.length === 0"> <p>No individual responses found.</p> </template>
            </div>
         </div>
     </template>

    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.5.4/dist/js/tabulator.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
